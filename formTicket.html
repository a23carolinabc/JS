<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Ticket</title>
    <link rel="stylesheet" href="css/index.css">
</head>
<body>
    <div class="contenedor">
        <nav class="cabecera">
            <div class="titulo">Tickets</div>
            <button class="btnLogOut" onclick="cerrarSesion()">Cerrar Sesión</button>
        </nav>
    
        <div class="contenido">
            <form>            
                <h2>Editar Ticket</h2>
        
                Título: <input type="text" name="titulo">
                <br>
                Descripción: <input type="text" name="descripcion">
                <br>
                Prioridad: 
                <select name="prioridad">
                    <option value="Alta">Alta</option>
                    <option value="Media">Media</option>
                    <option value="Baja">Baja</option>
                </select>
                <br>
                Estado: 
                <select name="estado">
                    <option value="Sin iniciar">Sin iniciar</option>
                    <option value="En progreso">En progreso</option>
                    <option value="Resuelto">Resuelto</option>
                </select>
                <br>
                Departamento: 
                <select name="departamento">
                    <option value="ASIR">ASIR</option>
                    <option value="DAW">DAW</option>
                    <option value="DAM">DAM</option>
                </select>
                <br>
                <br>
                <button type="button" onclick="guardarCambios()">Guardar Cambios</button>
                <button type="button" onclick="cancelarYVolver()">Cancelar y volver</button>
            </form> 
        </div>
    </div>
    <script src="js/cerrarSesion.js"></script>
    <script>
        window.onload = function() {
            // Obtener el ticket desde sessionStorage
            let ticket = JSON.parse(sessionStorage.getItem("ticketToEdit"));

            if (ticket) {
                // Llenar los campos del formulario con los datos del ticket
                document.querySelector('input[name="titulo"]').value = ticket.titulo;
                document.querySelector('input[name="descripcion"]').value = ticket.descripcion;
                document.querySelector('select[name="prioridad"]').value = ticket.prioridad;
                document.querySelector('select[name="estado"]').value = ticket.estado;
                document.querySelector('select[name="departamento"]').value = ticket.departamento;
            } else {
                console.error("No se encontró el ticket para editar.");
            }
        };
    </script>
    <script>
        function guardarCambios() {
            // Obtener el ticket original
            let ticketOriginal = JSON.parse(sessionStorage.getItem("ticketToEdit"));
            let tickets = JSON.parse(localStorage.getItem("tickets")) || [];
            
            // Obtener el nuevo departamento seleccionado
            const nuevoDepartamento = document.querySelector('select[name="departamento"]').value;
            
            // Asignar técnico según el nuevo departamento (como en crearTicket.js)
            let nuevoTecnico;
            switch (nuevoDepartamento) {
                case "DAM":
                    nuevoTecnico = "carol";
                    break;
                case "DAW":
                    nuevoTecnico = "hugo";
                    break;
                case "ASIR":
                    nuevoTecnico = "julio";
                    break;
                default:
                    nuevoTecnico = ticketOriginal.tecnico; // Por si hay un valor inesperado
            }

            // Actualizar datos del ticket
            const ticketActualizado = {
                ...ticketOriginal,
                titulo: document.querySelector('input[name="titulo"]').value,
                descripcion: document.querySelector('input[name="descripcion"]').value,
                prioridad: document.querySelector('select[name="prioridad"]').value,
                estado: document.querySelector('select[name="estado"]').value,
                departamento: nuevoDepartamento,
                tecnico: nuevoTecnico
            };
            
            // Reemplazar el ticket en el array
            const index = tickets.findIndex(t => t.id === ticketOriginal.id);
            tickets[index] = ticketActualizado;
            
            // Guardar y redirigir
            localStorage.setItem("tickets", JSON.stringify(tickets));
            window.location.href = "index.html";
        }

        function cancelarYVolver() {
            window.location.href = "index.html";
        }

    </script>
  
</body>
</html>
